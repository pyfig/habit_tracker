This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
4. Repository files, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

<additional_info>

</additional_info>

</file_summary>

<directory_structure>
backend/
  app/
    routes/
      auth.py
      habits.py
      marks.py
    auth.py
    db.py
    main.py
    models.py
    schemas.py
  Dockerfile
  requirements.txt
frontend/
  api.js
  app.js
  auth.js
  autorestart.sh
  calendar.js
  Dockerfile
  habits-handlers.js
  habits.js
  index.html
  nginx.conf
  styles.css
.gitignore
docker-compose.yml
LICENSE
main.sh
package.json
README_RUS.md
README.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="backend/app/routes/auth.py">
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from app.schemas import UserCreate, UserRead, Token
from app.auth import hash_password, create_access_token
from app.db import get_db
from app.auth import verify_password
from app.models import User
import uuid

router = APIRouter(prefix="/auth", tags=["auth"])

def get_user_by_username(username: str, db: Session = Depends(get_db)):
    return db.query(User).filter(User.username == username).first()

@router.post("/register", response_model=UserRead)
async def register(user_data: UserCreate, db: Session = Depends(get_db)):
    db_user = get_user_by_username(user_data.username, db)
    if db_user:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail="Username already registered"
        )
    
    hashed_password = hash_password(user_data.password)
    new_user = User(
        id=uuid.uuid4(),
        username=user_data.username,
        password=hashed_password
    )
    db.add(new_user)
    db.commit()
    db.refresh(new_user)
    return new_user

@router.post("/login", response_model=Token)
async def login(user_data: UserCreate, db: Session = Depends(get_db)):
    user = get_user_by_username(user_data.username, db)
    if not user or not verify_password(user_data.password, user.password):
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Incorrect username or password"
        )
    
    access_token = create_access_token({"sub": str(user.id)})
    return {"access_token": access_token, "token_type": "bearer"}
</file>

<file path="backend/app/auth.py">
from passlib.context import CryptContext
from jose import JWTError, jwt
from datetime import datetime, timedelta
from fastapi import Depends, HTTPException, status
from fastapi.security import OAuth2PasswordBearer
from sqlalchemy.orm import Session
import os
from dotenv import load_dotenv
from app.db import get_db
from app.models import User
from uuid import UUID

load_dotenv()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ JWT
SECRET_KEY = os.getenv("SECRET_KEY", "your-secret-key-for-jwt")
ALGORITHM = "HS256"
ACCESS_TOKEN_EXPIRE_MINUTES = 30

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")
oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/auth/login")

def hash_password(password: str) -> str:
    return pwd_context.hash(password)

def verify_password(plain_password: str, hashed_password: str) -> bool:
    return pwd_context.verify(plain_password, hashed_password)

def create_access_token(data: dict, expires_delta: timedelta = None):
    to_encode = data.copy()
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)
    to_encode.update({"exp": expire})
    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    return encoded_jwt

async def get_current_user(token: str = Depends(oauth2_scheme), db: Session = Depends(get_db)):
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="Could not validate credentials",
        headers={"WWW-Authenticate": "Bearer"},
    )
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        user_id: str = payload.get("sub")
        if user_id is None:
            raise credentials_exception
    except JWTError:
        raise credentials_exception
    
    user = db.query(User).filter(User.id == UUID(user_id)).first()
    if user is None:
        raise credentials_exception
    return user
</file>

<file path="backend/app/db.py">
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
import os
from dotenv import load_dotenv

load_dotenv()

DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://postgres:postgres@db:5432/habit_tracker")

engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
Base = declarative_base()

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
</file>

<file path="backend/Dockerfile">
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .

RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
</file>

<file path="backend/requirements.txt">
fastapi==0.95.0
uvicorn==0.21.1
sqlalchemy==2.0.7
psycopg2-binary==2.9.5
pydantic==1.10.7
python-jose==3.3.0
passlib==1.7.4
python-dotenv==1.0.0
bcrypt==4.0.1
python-multipart==0.0.6
</file>

<file path="frontend/Dockerfile">
FROM nginx:alpine

WORKDIR /usr/share/nginx/html

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
COPY . .

# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
</file>

<file path=".gitignore">
# Byte-compiled / optimized / DLL files
__pycache__/
*.py[cod]
*$py.class

# C extensions
*.so

# Distribution / packaging
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
share/python-wheels/
*.egg-info/
.installed.cfg
*.egg
MANIFEST

# PyInstaller
#  Usually these files are written by a python script from a template
#  before PyInstaller builds the exe, so as to inject date/other infos into it.
*.manifest
*.spec

# Installer logs
pip-log.txt
pip-delete-this-directory.txt

# Unit test / coverage reports
htmlcov/
.tox/
.nox/
.coverage
.coverage.*
.cache
nosetests.xml
coverage.xml
*.cover
*.py,cover
.hypothesis/
.pytest_cache/
cover/

# Translations
*.mo
*.pot

# Django stuff:
*.log
local_settings.py
db.sqlite3
db.sqlite3-journal

# Flask stuff:
instance/
.webassets-cache

# Scrapy stuff:
.scrapy

# Sphinx documentation
docs/_build/

# PyBuilder
.pybuilder/
target/

# Jupyter Notebook
.ipynb_checkpoints

# IPython
profile_default/
ipython_config.py

# pyenv
#   For a library or package, you might want to ignore these files since the code is
#   intended to run in multiple environments; otherwise, check them in:
# .python-version

# pipenv
#   According to pypa/pipenv#598, it is recommended to include Pipfile.lock in version control.
#   However, in case of collaboration, if having platform-specific dependencies or dependencies
#   having no cross-platform support, pipenv may install dependencies that don't work, or not
#   install all needed dependencies.
#Pipfile.lock

# UV
#   Similar to Pipfile.lock, it is generally recommended to include uv.lock in version control.
#   This is especially recommended for binary packages to ensure reproducibility, and is more
#   commonly ignored for libraries.
#uv.lock

# poetry
#   Similar to Pipfile.lock, it is generally recommended to include poetry.lock in version control.
#   This is especially recommended for binary packages to ensure reproducibility, and is more
#   commonly ignored for libraries.
#   https://python-poetry.org/docs/basic-usage/#commit-your-poetrylock-file-to-version-control
#poetry.lock

# pdm
#   Similar to Pipfile.lock, it is generally recommended to include pdm.lock in version control.
#pdm.lock
#   pdm stores project-wide configurations in .pdm.toml, but it is recommended to not include it
#   in version control.
#   https://pdm.fming.dev/latest/usage/project/#working-with-version-control
.pdm.toml
.pdm-python
.pdm-build/

# PEP 582; used by e.g. github.com/David-OConnor/pyflow and github.com/pdm-project/pdm
__pypackages__/

# Celery stuff
celerybeat-schedule
celerybeat.pid

# SageMath parsed files
*.sage.py

# Environments
.env
.venv
env/
venv/
ENV/
env.bak/
venv.bak/

# Spyder project settings
.spyderproject
.spyproject

# Rope project settings
.ropeproject

# mkdocs documentation
/site

# mypy
.mypy_cache/
.dmypy.json
dmypy.json

# Pyre type checker
.pyre/

# pytype static type analyzer
.pytype/

# Cython debug symbols
cython_debug/

# PyCharm
#  JetBrains specific template is maintained in a separate JetBrains.gitignore that can
#  be found at https://github.com/github/gitignore/blob/main/Global/JetBrains.gitignore
#  and can be added to the global gitignore or merged into this file.  For a more nuclear
#  option (not recommended) you can uncomment the following to ignore the entire idea folder.
#.idea/

# Ruff stuff:
.ruff_cache/

# PyPI configuration file
.pypirc
</file>

<file path="LICENSE">
MIT License

Copyright (c) 2025 xdshkaaa

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</file>

<file path="main.sh">
#!/bin/bash

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ

echo "–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∏ —É–¥–∞–ª—è—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker-compose down -v

echo "–ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞—é –æ–±—Ä–∞–∑—ã –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—ç—à–∞..."
docker-compose build --no-cache

echo "–ó–∞–ø—É—Å–∫–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ..."
docker-compose up -d

echo "–û—Ç–∫—Ä—ã–≤–∞—é http://localhost:3000 –≤ –±—Ä–∞—É–∑–µ—Ä–µ..."
if command -v xdg-open > /dev/null; then
    xdg-open http://localhost:3000
elif command -v open > /dev/null; then
    open http://localhost:3000
else
    echo "–ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://localhost:3000 –≤—Ä—É—á–Ω—É—é."
fi
</file>

<file path="package.json">
{
  "name": "habit_tracker",
  "version": "1.0.0",
  "description": "Habit Tracker Frontend",
  "main": "index.js",
  "scripts": {
    "dev": "vite"
  },
  "dependencies": {},
  "devDependencies": {
    "vite": "^4.0.0"
  }
}
</file>

<file path="backend/app/routes/marks.py">
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from typing import List
from uuid import UUID
from datetime import date

from app.db import get_db
from app.models import Mark, Habit, User
from app.schemas import MarkCreate, MarkRead
from app.auth import get_current_user

router = APIRouter(prefix="/marks", tags=["marks"])

@router.post("/", response_model=MarkRead)
async def create_mark(mark_data: MarkCreate, current_user: User = Depends(get_current_user), db: Session = Depends(get_db)):
    habit = db.query(Habit).filter(Habit.id == mark_data.habit_id, Habit.user_id == current_user.id).first()
    if not habit:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail="Habit not found or doesn't belong to current user")
    
    existing_mark = db.query(Mark).filter(Mark.habit_id == mark_data.habit_id, Mark.date == mark_data.date).first()
    if existing_mark:
        raise HTTPException(status_code=status.HTTP_400_BAD_REQUEST, detail="Mark for this date already exists")
    
    new_mark = Mark(
        habit_id=mark_data.habit_id,
        date=mark_data.date
    )
    db.add(new_mark)
    db.commit()
    db.refresh(new_mark)
    return new_mark

@router.get("/habit/{habit_id}", response_model=List[MarkRead])
async def get_marks_by_habit(habit_id: UUID, current_user: User = Depends(get_current_user), db: Session = Depends(get_db)):
    habit = db.query(Habit).filter(Habit.id == habit_id, Habit.user_id == current_user.id).first()
    if not habit:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail="Habit not found or doesn't belong to current user")
    
    marks = db.query(Mark).filter(Mark.habit_id == habit_id).all()
    return marks

@router.delete("/{mark_id}", status_code=status.HTTP_204_NO_CONTENT)
async def delete_mark(mark_id: UUID, current_user: User = Depends(get_current_user), db: Session = Depends(get_db)):
    mark = db.query(Mark).join(Habit).filter(
        Mark.id == mark_id,
        Habit.user_id == current_user.id
    ).first()
    
    if not mark:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail="Mark not found or doesn't belong to current user")
    
    db.delete(mark)
    db.commit()
    return None
</file>

<file path="backend/app/schemas.py">
from pydantic import BaseModel, Field, validator
from uuid import UUID
from typing import Optional, List
from datetime import date
import re

class UserCreate(BaseModel):
    username: str
    password: str
    
    @validator('username')
    def username_must_be_valid(cls, v):
        if not re.match(r'^[a-zA-Z0-9_-]{3,20}$', v):
            raise ValueError('–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 3 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤ –∏ –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ')
        return v
        
    @validator('password')
    def password_must_be_valid(cls, v):
        if not re.match(r'^[a-zA-Z0-9@#$%^&+=]{6,20}$', v):
            raise ValueError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 6 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤ –∏ –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (@#$%^&+=)')
        return v

class UserRead(BaseModel):
    id: UUID
    username: str

    class Config:
        orm_mode = True

class Token(BaseModel):
    access_token: str
    token_type: str = "bearer"

class HabitBase(BaseModel):
    name: str
    description: Optional[str] = None

class HabitCreate(HabitBase):
    pass

class HabitUpdate(HabitBase):
    name: Optional[str] = None

class HabitRead(HabitBase):
    id: UUID
    user_id: UUID

    class Config:
        orm_mode = True

class MarkCreate(BaseModel):
    habit_id: UUID
    date: date

class MarkRead(BaseModel):
    id: UUID
    habit_id: UUID
    date: date

    class Config:
        orm_mode = True
</file>

<file path="frontend/autorestart.sh">
#!/bin/bash

# yet another debug 
docker-compose down -v
docker-compose build --no-cache 
docker-compose up -d
</file>

<file path="docker-compose.yml">
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    depends_on:
      - db
    environment:
      - DATABASE_URL=postgresql://postgres:postgres@db:5432/habit_tracker
    networks:
      - habit-network
    restart: always

  frontend:
    build: ./frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    networks:
      - habit-network
    restart: always

  db:
    image: postgres:13
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=habit_tracker
    ports:
      - "5432:5432"
    networks:
      - habit-network
    restart: always

networks:
  habit-network:
    driver: bridge

volumes:
  postgres_data:
</file>

<file path="backend/app/models.py">
from sqlalchemy import Column, String, Text, ForeignKey, Date, Boolean  
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import relationship
import uuid

Base = declarative_base()

class User(Base):
    __tablename__ = "users"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    username = Column(String, unique=True, nullable=False)
    password = Column(String, nullable=False)
    
    habits = relationship("Habit", back_populates="user", cascade="all, delete-orphan")

class Habit(Base):
    __tablename__ = "habits"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
    name = Column(String, nullable=False)
    description = Column(Text, nullable=True)
    archived = Column(Boolean, default=False)
    completed = Column(Boolean, default=False)  # –ù–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

    user = relationship("User", back_populates="habits")
    marks = relationship("Mark", back_populates="habit", cascade="all, delete-orphan")

class Mark(Base):
    __tablename__ = "marks"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    habit_id = Column(UUID(as_uuid=True), ForeignKey("habits.id"), nullable=False)
    date = Column(Date, nullable=False)
    
    habit = relationship("Habit", back_populates="marks")
</file>

<file path="frontend/app.js">
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
let currentUser = null;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
function initApp() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    if (isAuthenticated()) {
        // –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        loadUserData();
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    initEventListeners();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function loadUserData() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–≤—ã—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    loadHabits();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
function initEventListeners() {
    
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
        }
    });
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', initApp);
</file>

<file path="frontend/auth.js">
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

// –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ñ–æ—Ä–º—ã
const authContainer = document.getElementById('auth-container');
const appContent = document.getElementById('app-content');
const loginForm = document.getElementById('login-form-element');
const registerForm = document.getElementById('register-form-element');
const loginError = document.getElementById('login-error');
const registerError = document.getElementById('register-error');
const logoutBtn = document.getElementById('logout-btn');
const tabBtns = document.querySelectorAll('.tab-btn');
const authForms = document.querySelectorAll('.auth-form');

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ localStorage
function saveToken(token) {
    localStorage.setItem('token', token);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏–∑ localStorage
function getToken() {
    const token = localStorage.getItem('token');
    return token;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏–∑ localStorage
function removeToken() {
    localStorage.removeItem('token');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function isAuthenticated() {
    return !!getToken();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏ –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
function switchAuthForm(formId) {
    authForms.forEach(form => {
        form.classList.remove('active');
    });
    
    tabBtns.forEach(btn => {
        btn.classList.remove('active');
    });
    
    document.getElementById(`${formId}-form`).classList.add('active');
    document.querySelector(`[data-tab="${formId}"]`).classList.add('active');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
function switchContainer() {
    if (isAuthenticated()) {
        authContainer.classList.add('hidden');
        appContent.classList.remove('hidden');
        loadUserData(); // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    } else {
        authContainer.classList.remove('hidden');
        appContent.classList.add('hidden');
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const username = document.getElementById('login-username').value;
    const password = document.getElementById('login-password').value;
    
    try {
        loginError.textContent = '';
        const response = await authApi.login(username, password);
        saveToken(response.access_token);
        switchContainer();
    } catch (error) {
        loginError.textContent = error.message || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å.';
    }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
registerForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const username = document.getElementById('register-username').value;
    const password = document.getElementById('register-password').value;
    const passwordConfirm = document.getElementById('register-password-confirm').value;
    
    if (password !== passwordConfirm) {
        registerError.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (!/^[a-zA-Z0-9_-]{3,20}$/.test(username)) {
        registerError.textContent = '–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 3 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤ –∏ –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ';
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–∞—Ä–æ–ª—è
    if (!/^[a-zA-Z0-9@#$%^&+=]{6,20}$/.test(password)) {
        registerError.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 6 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤ –∏ –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (@#$%^&+=)';
        return;
    }
    
    try {
        registerError.textContent = '';
        await authApi.register(username, password);
        // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ–º –≤—Ö–æ–¥
        const response = await authApi.login(username, password);
        saveToken(response.access_token);
        switchContainer();
    } catch (error) {
        registerError.textContent = error.message || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.';
    }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞
logoutBtn.addEventListener('click', () => {
    removeToken();
    switchContainer();
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
tabBtns.forEach(btn => {
    btn.addEventListener('click', () => {
        const tabId = btn.getAttribute('data-tab');
        switchAuthForm(tabId);
    });
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    switchContainer();
});
</file>

<file path="frontend/calendar.js">
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º –æ—Ç–º–µ—Ç–æ–∫

// –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
const calendarElement = document.getElementById('calendar');
const currentMonthElement = document.getElementById('current-month');
const prevMonthBtn = document.getElementById('prev-month');
const nextMonthBtn = document.getElementById('next-month');

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentDate = new Date();
let currentMonth = currentDate.getMonth();
let currentYear = currentDate.getFullYear();
let allMarks = {}; // –û–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–º–µ—Ç–æ–∫ –ø–æ –ø—Ä–∏–≤—ã—á–∫–∞–º

// –ù–∞–∑–≤–∞–Ω–∏—è –º–µ—Å—è—Ü–µ–≤
const monthNames = [
    '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
    '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
];

// –ù–∞–∑–≤–∞–Ω–∏—è –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
const weekdayNames = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–º–µ—Ç–æ–∫ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–∏–≤—ã—á–µ–∫
async function loadAllMarks() {
    try {
        const token = getToken();
        allMarks = {};
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–º–µ—Ç–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–∏–≤—ã—á–∫–∏
        for (const habit of habits) {
            const marks = await marksApi.getByHabit(habit.id, token);
            allMarks[habit.id] = marks;
        }
        
        renderCalendar();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–º–µ—Ç–æ–∫:', error);
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ
function getDaysInMonth(year, month) {
    return new Date(year, month + 1, 0).getDate();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞ (0 - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 1 - –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, ...)
function getFirstDayOfMonth(year, month) {
    const day = new Date(year, month, 1).getDay();
    return day === 0 ? 6 : day - 1; // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏ —Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –≤ —Å—Ç—Ä–æ–∫—É YYYY-MM-DD
function formatDate(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –µ—Å—Ç—å –ª–∏ –æ—Ç–º–µ—Ç–∫–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –¥–∞—Ç—É
function hasMarkOnDate(date) {
    const dateStr = formatDate(date);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –ø—Ä–∏–≤—ã—á–∫–∏
    for (const habitId in allMarks) {
        const habitMarks = allMarks[habitId];
        if (habitMarks.some(mark => mark.date === dateStr)) {
            return true;
        }
    }
    
    return false;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
function renderCalendar() {
    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å —Ç–µ–∫—É—â–∏–º –º–µ—Å—è—Ü–µ–º –∏ –≥–æ–¥–æ–º
    currentMonthElement.textContent = `${monthNames[currentMonth]} ${currentYear}`;
    
    // –û—á–∏—â–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
    calendarElement.innerHTML = '';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
    weekdayNames.forEach(day => {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-header';
        dayElement.textContent = day;
        calendarElement.appendChild(dayElement);
    });
    
    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ –∏ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞
    const daysInMonth = getDaysInMonth(currentYear, currentMonth);
    const firstDay = getFirstDayOfMonth(currentYear, currentMonth);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è –¥–Ω–µ–π –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
    for (let i = 0; i < firstDay; i++) {
        const prevMonthDate = new Date(currentYear, currentMonth, 0 - (firstDay - i - 1));
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day other-month';
        dayElement.textContent = prevMonthDate.getDate();
        calendarElement.appendChild(dayElement);
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –¥–Ω–∏ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
    const today = new Date();
    const todayDate = formatDate(today);
    
    for (let i = 1; i <= daysInMonth; i++) {
        const date = new Date(currentYear, currentMonth, i);
        const dateStr = formatDate(date);
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        dayElement.textContent = i;
        dayElement.setAttribute('data-date', dateStr);
        // –û—Ç–º–µ—á–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å
        if (dateStr === todayDate) {
            dayElement.classList.add('today');
        }
        // –û—Ç–º–µ—á–∞–µ–º –¥–Ω–∏ —Å –æ—Ç–º–µ—Ç–∫–∞–º–∏
        if (hasMarkOnDate(date)) {
            dayElement.classList.add('marked');
        }
        // –ë–ª–æ–∫–∏—Ä—É–µ–º –±—É–¥—É—â–µ–µ
        if (date > today) {
            dayElement.classList.add('disabled');
            dayElement.style.pointerEvents = 'none';
            dayElement.style.opacity = '0.5';
        } else {
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–º–µ—Ç–∫–∏
            dayElement.addEventListener('click', () => toggleMark(dateStr));
        }
        calendarElement.appendChild(dayElement);
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è –¥–Ω–µ–π —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞
    const totalCells = Math.ceil((firstDay + daysInMonth) / 7) * 7;
    const remainingCells = totalCells - (firstDay + daysInMonth);
    
    for (let i = 1; i <= remainingCells; i++) {
        const nextMonthDate = new Date(currentYear, currentMonth + 1, i);
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day other-month';
        dayElement.textContent = i;
        calendarElement.appendChild(dayElement);
    }
}
// —Ñ–∞–π–ª: frontend/calendar.js

// –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–º–µ—Ç–æ–∫ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∏ —Å–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è
async function loadAllMarks() {
    try {
        const token = getToken();
        allMarks = {};
        for (const habit of habits) {
            const marks = await marksApi.getByHabit(habit.id, token);
            allMarks[habit.id] = marks;
        }
        renderCalendar();
        renderCompletedToday(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–º–µ—Ç–æ–∫:', error);
    }
}



// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è –ø—Ä–∏–≤—ã—á–µ–∫
function renderCompletedToday() {
    const todayStr = formatDate(new Date());
    const listEl = document.getElementById('completed-today-list');
    listEl.innerHTML = '';

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∏–≤—ã—á–∫–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –æ—Ç–º–µ—Ç–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
    const doneHabits = habits.filter(habit => {
        const marks = allMarks[habit.id] || [];
        return marks.some(mark => mark.date === todayStr);
    });

    if (doneHabits.length === 0) {
        listEl.innerHTML = '<li>–ù–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫</li>';
    } else {
        doneHabits.forEach(habit => {
            const li = document.createElement('li');
            li.textContent = habit.name;
            listEl.appendChild(li);
        });
    }
}

function toggleTodayMark() {
    const today = formatDate(new Date()); // –°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å—Ç—Ä–æ–∫–∏
    const todayElement = document.querySelector(`.calendar-day[data-date="${today}"]`);

    if (todayElement) {
        todayElement.classList.toggle('marked');
    }
}


// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü
function goToPrevMonth() {
    currentMonth--;
    if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
    }
    renderCalendar();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü
function goToNextMonth() {
    currentMonth++;
    if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
    }
    renderCalendar();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–º–µ—Ç–∫–∏
async function toggleMark(dateStr) {
    if (habits.length !== 1) {
        return;
    }

    const selectedHabitId = habits[0].id;
    await processMarkToggle(selectedHabitId, dateStr);
}

// —Ñ–∞–π–ª: frontend/calendar.js

// –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–º–µ—Ç–æ–∫ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∏ —Å–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è
async function loadAllMarks() {
    try {
        const token = getToken();
        allMarks = {};
        for (const habit of habits) {
            const marks = await marksApi.getByHabit(habit.id, token);
            allMarks[habit.id] = marks;
        }
        renderCalendar();
        renderCompletedToday(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–º–µ—Ç–æ–∫:', error);
    }
}



// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–º–µ—Ç–∫–∏
async function processMarkToggle(habitId, dateStr) {
    try {
        const token = getToken();
        const habitMarks = allMarks[habitId] || [];
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –æ—Ç–º–µ—Ç–∫–∞ –Ω–∞ —ç—Ç—É –¥–∞—Ç—É
        const existingMark = habitMarks.find(mark => mark.date === dateStr);
        
        if (existingMark) {
            // –£–¥–∞–ª—è–µ–º –æ—Ç–º–µ—Ç–∫—É
            await marksApi.delete(existingMark.id, token);
            allMarks[habitId] = habitMarks.filter(mark => mark.id !== existingMark.id);
        } else {
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–º–µ—Ç–∫—É
            const newMark = await marksApi.create({
                habit_id: habitId,
                date: dateStr
            }, token);
            
            if (!allMarks[habitId]) {
                allMarks[habitId] = [];
            }
            
            allMarks[habitId].push(newMark);
        }
        
        renderCalendar();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ—Ç–º–µ—Ç–∫–∏:', error);
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ—Å—è—Ü–µ–≤
prevMonthBtn.addEventListener('click', goToPrevMonth);
nextMonthBtn.addEventListener('click', goToNextMonth);

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
function updateCalendar() {
    loadAllMarks();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
renderCalendar();
</file>

<file path="frontend/index.html">
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <div id="auth-container" class="container">
            <div class="tabs">
                <button class="tab-btn active" data-tab="login">–í—Ö–æ–¥</button>
                <button class="tab-btn" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
            
            <div id="login-form" class="auth-form active">
                <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
                <form id="login-form-element">
                    <div class="form-group">
                        <label for="login-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="login-username" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <button type="submit" class="btn primary-btn">–í–æ–π—Ç–∏</button>
                </form>
                <div id="login-error" class="error-message"></div>
            </div>
            
            <div id="register-form" class="auth-form">
                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                <form id="register-form-element">
                    <div class="form-group">
                        <label for="register-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="register-username" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="register-password" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password-confirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="register-password-confirm" required>
                    </div>
                    <button type="submit" class="btn primary-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </form>
                <div id="register-error" class="error-message"></div>
            </div>
        </div>
        
        <div id="app-content" class="container hidden">
            <header>
                <h1>–¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫</h1>
                <button id="logout-btn" class="btn secondary-btn">–í—ã–π—Ç–∏</button>
            </header>
            
            <div class="content-wrapper">
                <div class="habits-section">
                    <div class="habits-header">
                        <h2>–ú–æ–∏ –ø—Ä–∏–≤—ã—á–∫–∏</h2>
                        <button id="add-habit-btn" class="btn primary-btn"><i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                    
                    <div id="habits-list" class="habits-list">
                        <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø—Ä–∏–≤—ã—á–∫–∏ -->
                    </div>
                </div>
                
                <div class="calendar-section">
                    <h2>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –æ—Ç–º–µ—Ç–æ–∫</h2>
                    <div class="calendar-controls">
                        <button id="prev-month" class="btn icon-btn"><i class="fas fa-chevron-left"></i></button>
                        <h3 id="current-month">–ú–µ—Å—è—Ü –ì–æ–¥</h3>
                        <button id="next-month" class="btn icon-btn"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div id="calendar" class="calendar">
                        <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–∞–ª–µ–Ω–¥–∞—Ä—å -->
                    </div>

                    <!-- –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –±–ª–æ–∫ —Å–ø–∏—Å–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫ —Å–µ–≥–æ–¥–Ω—è -->
                    <h3>–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ —Å–µ–≥–æ–¥–Ω—è:</h3>
                    <ul id="completed-today-list" class="completed-list"></ul>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–≤—ã—á–∫–∏ -->
        <div id="habit-modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2 id="habit-modal-title">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</h2>
                <form id="habit-form">
                    <input type="hidden" id="habit-id">
                    <div class="form-group">
                        <label for="habit-name">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="habit-name" required>
                    </div>
                    <div class="form-group">
                        <label for="habit-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="habit-description" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" id="cancel-habit" class="btn secondary-btn">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn primary-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script src="api.js"></script>
    <script src="auth.js"></script>
    <script src="habits.js"></script>
    <script src="habits-handlers.js"></script>
    <script src="calendar.js"></script>
    <script src="app.js"></script>
</body>
</html>
</file>

<file path="frontend/nginx.conf">
server {
    listen 80;
    server_name _;

    # –û—Ç–¥–∞—ë–º —Å—Ç–∞—Ç–∏–∫—É
    root /usr/share/nginx/html;
    index index.html;

    # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∫—Å–∏—Ä—É–µ–º API
    location /api/ {
        # proxy_pass –±–µ–∑ —Å—É—Ñ—Ñ–∏–∫—Å–∞ /api/, —á—Ç–æ–±—ã path —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è
        proxy_pass http://backend:8000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –Ω–∞—à SPA
    location / {
        try_files $uri $uri/ /index.html;
    }
}
</file>

<file path="README_RUS.md">
# –¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫

–ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ, –æ—Ç–º–µ—á–∞–π—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º —á–µ—Ä–µ–∑ –∫–∞–ª–µ–Ω–¥–∞—Ä—å.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**: —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ —Å –∏–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª–µ–º
- **–í—Ö–æ–¥**: –¥–æ—Å—Ç—É–ø –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É
- **–í—ã—Ö–æ–¥**: –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∞–º–∏
- **–°–æ–∑–¥–∞–Ω–∏–µ**: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø—Ä–∏–≤—ã—á–∫–∏ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–∫–∏
- **–£–¥–∞–ª–µ–Ω–∏–µ**: —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫
- **–ê—Ä—Ö–∏–≤–∞—Ü–∏—è**: –ø–µ—Ä–µ–Ω–æ—Å –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫ –≤ –∞—Ä—Ö–∏–≤

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- **–û—Ç–º–µ—Ç–∫–∏ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏**: –ø–æ–º–µ—Ç–∫–∞ –ø—Ä–∏–≤—ã—á–µ–∫ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
- **–ö–∞–ª–µ–Ω–¥–∞—Ä—å**: –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–ø–æ—á–µ–∫ —É—Å–ø–µ—Ö–æ–≤
- **–°–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è –ø—Ä–∏–≤—ã—á–µ–∫**
- **–£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ—Ç–∫–∏**: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Docker  
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Git

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone git@github.com:pyfig/habit_tracker.git
cd habit_tracker
./main.sh
```

- **–ë—ç–∫–µ–Ω–¥**: http://localhost:8000  
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: http://localhost:3000  
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)**: –ø–æ—Ä—Ç 5432  


## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
üì¶ habit_tracker
‚îú‚îÄ backend/
‚îú‚îÄ frontend/
‚îú‚îÄ docker-compose.yml
‚îú‚îÄ main.sh
‚îú‚îÄ package.json
‚îî‚îÄ README_RUS.md
```

## API

| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç                        | –û–ø–∏—Å–∞–Ω–∏–µ                    |
|-------|----------------------------------|------------------------------|
| POST  | `/api/auth/register`             | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| POST  | `/api/auth/login`                | –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É               |
| GET   | `/api/habits`                    | –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–∏–≤—ã—á–∫–∏        |
| POST  | `/api/habits`                    | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø—Ä–∏–≤—ã—á–∫—É       |
| GET   | `/api/habits/{habit_id}`         | –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–∏–≤—ã—á–∫–µ   |
| PUT   | `/api/habits/{habit_id}`         | –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É            |
| DELETE| `/api/habits/{habit_id}`         | –£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É             |
| POST  | `/api/marks`                     | –°–æ–∑–¥–∞—Ç—å –æ—Ç–º–µ—Ç–∫—É              |
| GET   | `/api/marks/habit/{habit_id}`    | –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ—Ç–º–µ—Ç–∫–∏ –ø—Ä–∏–≤—ã—á–∫–∏|
| DELETE| `/api/marks/{mark_id}`           | –£–¥–∞–ª–∏—Ç—å –æ—Ç–º–µ—Ç–∫—É              |

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

**–ë—ç–∫–µ–Ω–¥**  
- FastAPI, Uvicorn, SQLAlchemy, PostgreSQL, Docker

**–§—Ä–æ–Ω—Ç–µ–Ω–¥**  
- HTML5, CSS3, JavaScript, AJAX, FontAwesome, Vite

## –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫ –∏–∑ –∞—Ä—Ö–∏–≤–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–∏–≤—ã—á–∫–∞—Ö
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–≤—ã—á–µ–∫
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
</file>

<file path="backend/app/main.py">
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.routes import auth, habits, marks
from app.models import Base
from app.db import engine

# –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
Base.metadata.create_all(bind=engine)

app = FastAPI(title="Habit Tracker API")

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS
origins = [
    "http://localhost:3000",
    "http://127.0.0.1:3000",
    "http://localhost:80",
    "http://127.0.0.1:80",
    "http://localhost",
    "http://127.0.0.1",
    "http://localhost:*",
    "http://127.0.0.1:*"
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–∞—Ä—à—Ä—É—Ç—ã
app.include_router(auth.router, prefix="/api")
app.include_router(habits.router, prefix="/api")
app.include_router(marks.router, prefix="/api")


@app.get("/")
async def root():
    return {"message": "Welcome to Habit Tracker API"}
</file>

<file path="frontend/styles.css">
:root {
    --primary-color: #4a6fa5;
    --primary-dark: #3a5a8c;
    --secondary-color: #6c757d;
    --success-color: #60e980;
    --danger-color: #dc3545;
    --light-color: #f8f9fa;
    --dark-color: #343a40;
    --border-color: #dee2e6;
    --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: var(--dark-color);
    background-color: #f5f7fa;
    min-height: 100vh;
}

.app-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.container {
    background-color: white;
    border-radius: 8px;
    box-shadow: var(--shadow);
    padding: 30px;
    margin-bottom: 20px;
}

/* –ö–Ω–æ–ø–∫–∏ */
.btn {
    display: inline-block;
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease;
}

.primary-btn {
    background-color: var(--primary-color);
    color: white;
}

.primary-btn:hover {
    background-color: var(--primary-dark);
}

.secondary-btn {
    background-color: var(--secondary-color);
    color: white;
}

.secondary-btn:hover {
    background-color: #5a6268;
}

.icon-btn {
    background-color: transparent;
    color: var(--primary-color);
    padding: 5px 10px;
}

.icon-btn:hover {
    color: var(--primary-dark);
}

/* –§–æ—Ä–º—ã */
.form-group {
    margin-bottom: 20px;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
}

input, textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 16px;
}

input:focus, textarea:focus {
    outline: none;
    border-color: var(--primary-color);
}

/* –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è */
#auth-container {
    max-width: 500px;
    margin: 50px auto;
}

.tabs {
    display: flex;
    margin-bottom: 20px;
    border-bottom: 1px solid var(--border-color);
}

.tab-btn {
    flex: 1;
    padding: 10px;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    color: var(--secondary-color);
}

.tab-btn.active {
    color: var(--primary-color);
    border-bottom: 2px solid var(--primary-color);
}

.auth-form {
    display: none;
}

.auth-form.active {
    display: block;
}

.error-message {
    color: var(--danger-color);
    margin-top: 10px;
    font-size: 14px;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.content-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

@media (max-width: 768px) {
    .content-wrapper {
        grid-template-columns: 1fr;
    }
}

/* –°–µ–∫—Ü–∏—è –ø—Ä–∏–≤—ã—á–µ–∫ */
.habits-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.habits-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.habit-item {
    background-color: white;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    border-left: 4px solid var(--primary-color);
}

.habit-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.habit-title {
    font-size: 18px;
    font-weight: 600;
}

.habit-actions {
    display: flex;
    gap: 10px;
}

.habit-action {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 16px;
    color: var(--secondary-color);
}

.habit-action:hover {
    color: var(--primary-color);
}

.habit-description {
    color: var(--secondary-color);
    font-size: 14px;
}

/* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
.calendar-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
}

.calendar-day {
    aspect-ratio: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 50%;
    font-size: 14px;
    cursor: pointer;
}

.calendar-day.today {
    border: 2px solid var(--primary-color);
}

.calendar-day.marked {
    background-color: var(--success-color);
    color: white;
}

.calendar-day.other-month {
    color: var(--secondary-color);
    opacity: 0.5;
}

.calendar-day:hover {
    background-color: var(--light-color);
}

.calendar-day.marked:hover {
    background-color: var(--success-color);
    opacity: 0.8;
}

.calendar-header {
    font-weight: bold;
    text-align: center;
    padding: 5px 0;
}

/* —Ñ–∞–π–ª: frontend/styles.css */
/* –°–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è –ø—Ä–∏–≤—ã—á–µ–∫ */
.completed-list {
    list-style-type: disc;
    padding-left: 20px;
    margin-top: 10px;
    color: var(--dark-color);
}
/* –∫–Ω–æ–ø–∫–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å–ø–∏—Å–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è */
.completed-list .archive-today-btn {
    margin-left: 10px;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.9em;
    color: var(--danger-color);
  }
  .completed-list .archive-today-btn:hover {
    text-decoration: underline;
  }
  

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
    background-color: white;
    margin: 10% auto;
    padding: 30px;
    border-radius: 8px;
    max-width: 500px;
    box-shadow: var(--shadow);
    position: relative;
}

.close {
    position: absolute;
    right: 20px;
    top: 15px;
    font-size: 24px;
    cursor: pointer;
    color: var(--secondary-color);
}

.close:hover {
    color: var(--dark-color);
}

.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
}


/* –£—Ç–∏–ª–∏—Ç—ã */
.hidden {
    display: none;
}
</file>

<file path="backend/app/routes/habits.py">
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from typing import List
from uuid import UUID

from app.db import get_db
from app.models import Habit, User
from app.schemas import HabitCreate, HabitRead, HabitUpdate
from app.auth import get_current_user
from sqlalchemy.exc import IntegrityError

router = APIRouter(prefix="/habits", tags=["habits"])

@router.post("/", response_model=HabitRead)
async def create_habit(habit_data: HabitCreate, current_user: User = Depends(get_current_user), db: Session = Depends(get_db)):
    try:
        new_habit = Habit(
            user_id=current_user.id,
            name=habit_data.name,
            description=habit_data.description
        )
        db.add(new_habit)
        db.commit()
        db.refresh(new_habit)
        return new_habit
    except IntegrityError:
        db.rollback()
        raise HTTPException(status_code=400, detail="Habit already exists or other integrity error")

@router.get("/", response_model=List[HabitRead])
async def get_habits(current_user: User = Depends(get_current_user), db: Session = Depends(get_db)):
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ (–Ω–µ–∞—Ä—Ö–∏–≤–Ω—ã–µ) –ø—Ä–∏–≤—ã—á–∫–∏
    habits = (
        db.query(Habit)
          .filter(Habit.user_id == current_user.id, Habit.archived == False)
          .all()
    )
    return habits

@router.get("/{habit_id}", response_model=HabitRead)
async def get_habit(habit_id: UUID, current_user: User = Depends(get_current_user), db: Session = Depends(get_db)):
    habit = db.query(Habit).filter(Habit.id == habit_id, Habit.user_id == current_user.id).first()
    if not habit:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail="Habit not found")
    return habit

@router.put("/{habit_id}", response_model=HabitRead)
async def update_habit(habit_id: UUID, habit_data: HabitUpdate, current_user: User = Depends(get_current_user), db: Session = Depends(get_db)):
    habit = db.query(Habit).filter(Habit.id == habit_id, Habit.user_id == current_user.id).first()
    if not habit:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail="Habit not found")
    
    for key, value in habit_data.dict(exclude_unset=True).items():
        setattr(habit, key, value)
    
    db.commit()
    db.refresh(habit)
    return habit

@router.delete("/{habit_id}", status_code=status.HTTP_204_NO_CONTENT)
async def delete_habit(habit_id: UUID, current_user: User = Depends(get_current_user), db: Session = Depends(get_db)):
    habit = db.query(Habit).filter(Habit.id == habit_id, Habit.user_id == current_user.id).first()
    if not habit:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail="Habit not found")
    
    db.delete(habit)
    db.commit()
    return None

@router.post("/{habit_id}/archive", status_code=status.HTTP_204_NO_CONTENT)
async def archive_habit(habit_id: UUID, current_user: User = Depends(get_current_user), db: Session = Depends(get_db)):
    habit = db.query(Habit).filter(Habit.id == habit_id, Habit.user_id == current_user.id).first()
    if not habit:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail="Habit not found or doesn't belong to current user")
    
    
    habit.archived = True  
    db.commit()
    db.refresh(habit)
    return None

@router.post("/{habit_id}/complete", status_code=status.HTTP_204_NO_CONTENT)
async def complete_habit(
    habit_id: UUID, current_user: User = Depends(get_current_user), db: Session = Depends(get_db)
):
    habit = db.query(Habit).filter(Habit.id == habit_id, Habit.user_id == current_user.id).first()
    if not habit:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail="Habit not found or doesn't belong to current user")
    
    # –ü–æ–º–µ—á–∞–µ–º –ø—Ä–∏–≤—ã—á–∫—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é
    habit.completed = True  
    db.commit()
    db.refresh(habit)
    return None
</file>

<file path="frontend/habits.js">
// apiClient.js

const API_URL = 'http://localhost:8000/api';

class ApiClient {
  constructor(baseURL = API_URL) {
    this.baseURL = baseURL;
    this.tokenKey = 'auth_token';
  }

  // –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –∏–∑ localStorage
  get token() {
    return localStorage.getItem(this.tokenKey);
  }

  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω
  set token(value) {
    if (value) {
      localStorage.setItem(this.tokenKey, value);
    } else {
      localStorage.removeItem(this.tokenKey);
    }
  }

  // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–ø—Ä–æ—Å–æ–≤
  async request(endpoint, { method = 'GET', data = null } = {}) {
    const url = `${this.baseURL}${endpoint}`;
    const headers = { 'Content-Type': 'application/json' };

    if (this.token) {
      headers['Authorization'] = `Bearer ${this.token}`;
    }

    const config = {
      method,
      headers,
      credentials: 'include'
    };

    if (data && ['POST', 'PUT', 'PATCH'].includes(method.toUpperCase())) {
      config.body = JSON.stringify(data);
    }

    console.debug('[API Request]', method, url, data ? data : '');

    const res = await fetch(url, config);

    // 204 No Content
    if (res.status === 204) {
      return null;
    }

    let payload;
    try {
      payload = await res.json();
    } catch {
      throw new Error(`Invalid JSON in response from ${endpoint}`);
    }

    if (!res.ok) {
      const msg = payload.detail || payload.message || res.statusText;
      throw new Error(`API Error (${res.status}): ${msg}`);
    }

    return payload;
  }

  // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  async login(username, password) {
    const data = await this.request('/auth/login', {
      method: 'POST',
      data: { username, password }
    });
    if (data.token) this.token = data.token;
    return data;
  }

  async register(username, password) {
    const data = await this.request('/auth/register', {
      method: 'POST',
      data: { username, password }
    });
    if (data.token) this.token = data.token;
    return data;
  }
  async completeHabit(id) {
    return this.request(`/habits/${id}/complete`, {
      method: 'POST'
    });
  }  
  async logout() {
    this.token = null;
  }

  // –ü—Ä–∏–≤—ã—á–∫–∏
  async getHabits() {
    return this.request('/habits', { method: 'GET' });
  }

  async getHabitById(id) {
    return this.request(`/habits/${id}`, { method: 'GET' });
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ createHabit —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
  async createHabit(habit) {
    try {
      const data = await this.request('/habits', {
        method: 'POST',
        data: habit
      });
      console.log('–ü—Ä–∏–≤—ã—á–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞:', data);
      return data;
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–≤—ã—á–∫–∏:', error);
      throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É');
    }
  }
  
  // –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–∞–ª–µ–Ω–¥–∞—Ä—è
  async syncCalendar(habitId) {
    const marks = await this.getMarks(habitId);
    // –õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
    return marks;
  }

  async updateHabit(id, habit) {
    return this.request(`/habits/${id}`, {
      method: 'PUT',
      data: habit
    });
  }

  async deleteHabit(id) {
    return this.request(`/habits/${id}`, { method: 'DELETE' });
  }

  // –û—Ç–º–µ—Ç–∫–∏
  async getMarks(habitId) {
    return this.request(`/marks/habit/${habitId}`, { method: 'GET' });
  }

  async createMark(mark) {
    return this.request('/marks', {
      method: 'POST',
      data: mark
    });
  }

  async deleteMark(id) {
    return this.request(`/marks/${id}`, { method: 'DELETE' });
  }
}

// –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä API –∫–ª–∏–µ–Ω—Ç–∞
const api = new ApiClient();

// –î–µ–ª–∞–µ–º –º–µ—Ç–æ–¥—ã API –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
const habitsApi = {
  getAll: (token) => api.getHabits(),
  getById: (id, token) => api.getHabitById(id),
  create: (habitData, token) => api.createHabit(habitData),
  update: (id, habitData, token) => api.updateHabit(id, habitData),
  delete: (id, token) => api.deleteHabit(id),
  complete: (id, token) => api.completeHabit(id)  // ‚Üê –≤–æ—Ç —ç—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º!
};

// API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Ç–º–µ—Ç–∫–∞–º–∏
const marksApi = {
  getByHabit: (habitId, token) => api.getMarks(habitId),
  create: (markData, token) => api.createMark(markData),
  delete: (id, token) => api.deleteMark(id)
};
</file>

<file path="frontend/api.js">
// API URL
const API_URL = 'http://localhost:8000/api';

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
async function apiRequest(endpoint, method = 'GET', data = null, token = null) {
    const headers = {
        'Content-Type': 'application/json'
    };
    
    if (token) {
        headers['Authorization'] = `Bearer ${token}`;
    }
    
    const config = {
        method,
        headers,
        credentials: 'include'
    };
    
    if (data && (method === 'POST' || method === 'PUT')) {
        config.body = JSON.stringify(data);
    }
    
    try {
        console.log('Request:', `${API_URL}${endpoint}`, config);
        const response = await fetch(`${API_URL}${endpoint}`, config);
        
        if (response.status === 204) {
            return { success: true };
        }
        
        const result = await response.json();
        console.log('Response:', result);
        
        if (!response.ok) {
            throw new Error(result.detail || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞');
        }
        
        return result;
    } catch (error) {
        console.error('API Error:', error);
        throw new Error(`API Error: ${error.message} (endpoint: ${endpoint})`);
    }
}

// API –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
const authApi = {
    login: async (username, password) => {
        return apiRequest('/auth/login', 'POST', { username, password });
    },
    
    register: async (username, password) => {
        return apiRequest('/auth/register', 'POST', { username, password });
    }
};


// API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∏–≤—ã—á–∫–∞–º–∏
const habitsApi = {
    getAll: async (token) => {
        return apiRequest('/habits', 'GET', null, token);
    },
    getById: async (id, token) => {
        return apiRequest(`/habits/${id}`, 'GET', null, token);
    },
    create: async (habitData, token) => {
        return apiRequest('/habits', 'POST', habitData, token);
    },
    update: async (id, habitData, token) => {
        return apiRequest(`/habits/${id}`, 'PUT', habitData, token);
    },
    delete: async (id, token) => {
        return apiRequest(`/habits/${id}`, 'DELETE', null, token);
    },
    archive: async (id, token) => {
        return apiRequest(`/habits/${id}/archive`, 'POST', null, token);
    },
    complete: async (id, token) => {
        return apiRequest(`/habits/${id}/complete`, 'POST', null, token);
    }    
};




// API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Ç–º–µ—Ç–∫–∞–º–∏
const marksApi = {
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—Ç–º–µ—Ç–æ–∫ –ø–æ –ø—Ä–∏–≤—ã—á–∫–µ (—Å–µ–π—á–∞—Å –ø—É—Ç—å /api/marks/habit/{habitId})
    getByHabit: async (habitId, token) => {
      return apiRequest(`/marks/habit/${habitId}`, 'GET', null, token);
    },
  
    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –æ—Ç–º–µ—Ç–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é –¥–∞—Ç—É date)
    create: async (markData, token) => {
      return apiRequest('/marks', 'POST', markData, token);
    },
  
    // –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ—Ç–∫–∏ –ø–æ id
    delete: async (id, token) => {
      return apiRequest(`/marks/${id}`, 'DELETE', null, token);
    }
  };
</file>

<file path="frontend/habits-handlers.js">
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∞–º–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
const habitsList = document.getElementById('habits-list');
const addHabitBtn = document.getElementById('add-habit-btn');
const habitForm = document.getElementById('habit-form');
const habitModal = document.getElementById('habit-modal');
const modalCloseBtn = habitModal.querySelector('.close');
const cancelHabitBtn = document.getElementById('cancel-habit');

let habits = [];

// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function openHabitModal(editingId = null) {
  // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
  habitForm.reset();
  delete habitForm.dataset.editing;
  document.getElementById('habit-modal-title').textContent = editingId ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫—É' : '–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É';
  if (editingId) habitForm.dataset.editing = editingId;
  habitModal.style.display = 'block';
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function closeHabitModal() {
  habitModal.style.display = 'none';
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–≤—ã—á–µ–∫ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

async function loadHabits() {
    try {
        const token = getToken();
        habits = await habitsApi.getAll(token);
        // –§–∏–ª—å—Ç—Ä—É–µ–º –∞—Ä—Ö–∏–≤–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ active
        habits = habits.filter(habit => !habit.archived);
        renderHabits();
        renderCompletedToday();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–≤—ã—á–µ–∫:', error);
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–≤—ã—á–µ–∫
function renderHabits() {
    habitsList.innerHTML = '';

    // –û—Ç–±–∏—Ä–∞–µ–º –ø—Ä–∏–≤—ã—á–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω—ã –∏ –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
    const activeHabits = habits.filter(habit => !habit.archived && !habit.completed);

    if (activeHabits.length === 0) {
        habitsList.innerHTML = '<div class="empty-state">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫.</div>';
        return;
    }

    activeHabits.forEach(habit => {
        const habitElement = document.createElement('div');
        habitElement.className = 'habit-item';
        habitElement.innerHTML = `
            <div class="habit-info">
                <h3>${habit.name}</h3>
                <p>${habit.description || ''}</p>
            </div>
            <div class="habit-actions">
                <button class="btn icon-btn edit-habit" data-id="${habit.id}"><i class="fas fa-edit"></i></button>
                <button class="btn icon-btn archive-habit" data-id="${habit.id}"><i class="fas fa-archive"></i></button>
                <button class="btn icon-btn delete-habit" data-id="${habit.id}"><i class="fas fa-trash"></i></button>
                <button class="btn icon-btn complete-habit" data-id="${habit.id}"><i class="fa-solid fa-circle-check"></i></button>
            </div>
        `;

        habitsList.appendChild(habitElement);

        habitElement.querySelector('.complete-habit').addEventListener('click', () => completeHabit(habit.id));
        habitElement.querySelector('.edit-habit').addEventListener('click', () => openHabitModal(habit.id));
        habitElement.querySelector('.delete-habit').addEventListener('click', () => deleteHabit(habit.id));
        habitElement.querySelector('.archive-habit').addEventListener('click', () => archiveHabit(habit.id));
    });
}



async function loadHabits() {
    try {
        const token = getToken();
        habits = await habitsApi.getAll(token);
        habits = habits.filter(habit => !habit.archived);
        renderHabits();
        renderCompletedToday();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–≤—ã—á–µ–∫:', error);
    }
}





// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø—Ä–∏–≤—ã—á–∫–∏
async function addHabit() {
    const name = document.getElementById('habit-name').value.trim();
    const description = document.getElementById('habit-description').value.trim();
    if (!name) {
        alert('–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.');
        return;
    }
    try {
        const token = getToken();
        const newHabit = await habitsApi.create({ name, description }, token);
        habits.push(newHabit);
        renderHabits();
        closeHabitModal();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏:', error);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏
async function updateHabit(habitId) {
    const name = document.getElementById('habit-name').value.trim();
    const description = document.getElementById('habit-description').value.trim();
    if (!name) {
        alert('–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.');
        return;
    }
    try {
        const token = getToken();
        const updated = await habitsApi.update(habitId, { name, description }, token);
        const idx = habits.findIndex(h => h.id === habitId);
        habits[idx] = updated;
        renderHabits();
        closeHabitModal();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏:', error);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
    }
}

habitForm.addEventListener('submit', event => {
    event.preventDefault();
    const editingId = habitForm.dataset.editing;
    if (editingId) updateHabit(editingId);
    else addHabit();
});

addHabitBtn.addEventListener('click', () => openHabitModal());
modalCloseBtn.addEventListener('click', closeHabitModal);
cancelHabitBtn.addEventListener('click', closeHabitModal);
window.addEventListener('click', event => {
  if (event.target === habitModal) closeHabitModal();
});

async function archiveHabit(habitId) {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –ø—Ä–∏–≤—ã—á–∫—É?')) return;
    try {
        const token = getToken();
        await habitsApi.archive(habitId, token);
        habits = habits.filter(habit => habit.id !== habitId);
        renderHabits();
        renderCompletedToday();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏:', error);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
    }
}

async function deleteHabit(habitId) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø—Ä–∏–≤—ã—á–∫—É?')) return;
    try {
        const token = getToken();
        await habitsApi.delete(habitId, token);
        habits = habits.filter(habit => habit.id !== habitId);
        renderHabits();
        renderCompletedToday();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏:', error);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
    }
}



async function completeHabit(habitId) {
    console.log('Complete clicked', habitId);
    try {
        const token = getToken();
        await habitsApi.complete(habitId, token);
        console.log('Complete API request done');

        const completedHabit = habits.find(h => h.id === habitId);
        if (completedHabit) {
            completedHabit.completed = true;  // ‚Üê —Å—Ç–∞–≤–∏–º –≥–∞–ª–æ—á–∫—É
        }

        renderHabits();          // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏
        renderCompletedToday();  // –æ–±–Ω–æ–≤–ª—è–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–∫–∏:', error);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é.');
    }
}




// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
loadHabits();
</file>

<file path="README.md">
# README.md (English)

# Habit Tracker

Simple and intuitive app to form and maintain daily habits. Create, edit, track progress in the calendar, and see completed habits for today.

## Features

### Authentication
- **Register**: create a new account with username and password
- **Login**: access your personal habit tracker
- **Logout**: securely end your session

### Habit Management
- **Create**: add a new habit with name and optional description
- **Edit**: update habit details
- **Delete**: remove unnecessary habits
- **Archive**: move inactive habits to archive

### Progress Tracking
- **Mark Completion**: mark a habit as completed on a selected day
- **Calendar View**: visualize your streaks and history
- **Today's Completed Habits**: see a list of today's successes
- **Remove Mark**: undo wrong marks

## Quick Start

### Requirements

- Docker  
- Git

### Installation

```bash
git clone git@github.com:pyfig/habit_tracker.git
cd habit_tracker
./main.sh
```

- **Backend**: http://localhost:8000  
- **Frontend**: http://localhost:3000  
- **Database**: port 5432


## Project Structure

```
üì¶ habit_tracker
‚îú‚îÄ backend/
‚îú‚îÄ frontend/
‚îú‚îÄ docker-compose.yml
‚îú‚îÄ main.sh
‚îú‚îÄ package.json
‚îî‚îÄ README.md
```

## API Overview

| Method | Endpoint                     | Description                 |
|--------|------------------------------|-----------------------------|
| POST   | `/api/auth/register`         | Register new user           |
| POST   | `/api/auth/login`            | Login user                  |
| GET    | `/api/habits`                | Get all habits              |
| POST   | `/api/habits`                | Create a new habit          |
| GET    | `/api/habits/{habit_id}`     | Get habit details           |
| PUT    | `/api/habits/{habit_id}`     | Update habit                |
| DELETE | `/api/habits/{habit_id}`     | Delete habit                |
| POST   | `/api/marks`                 | Create a mark (track habit) |
| GET    | `/api/marks/habit/{habit_id}`| Get all marks for habit     |
| DELETE | `/api/marks/{mark_id}`       | Delete a mark               |

## Technologies

**Backend**  
- FastAPI, Uvicorn, SQLAlchemy, PostgreSQL, Docker

**Frontend**  
- HTML5, CSS3, JavaScript, AJAX, FontAwesome, Vite

## Roadmap

- Automatic tests
- Habit archive browsing
- Habit recovery from archive
- Mobile optimization
- Analytics and statistics

---
</file>

</files>
